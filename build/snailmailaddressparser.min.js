if(typeof require!=="function"){if(typeof XRegExp!=="function"){console.log("No XRegExp object found - is it installed?.")}if(typeof _!=="function"){console.log("Underscore or lodash were not found. Is one installed?")}var define=function(a,e){window.snailmailaddressparser=e(_,{XRegExp:XRegExp})}}else{if(typeof define!=="function"){var define=require("amdefine")(module)}}define(["underscore","xregexp"],function(a,e){var s=e.XRegExp,n;s.addUnicodePackage();n="0.1.8-alpha";var i,l,t,r;r=[{name:"Afghanistan",aliases:["AF"]},{name:"Åland Islands",aliases:["AX","Aland Islands"]},{name:"Albania",aliases:["AL"]},{name:"Algeria",aliases:["DZ"]},{name:"American Samoa",aliases:["AS"]},{name:"Andorra",aliases:["AD"]},{name:"Angola",aliases:["AO"]},{name:"Anguilla",aliases:["AI"]},{name:"Antarctica",aliases:["AQ"]},{name:"Antigua and Barbuda",aliases:["AG"]},{name:"Argentina",aliases:["AR"]},{name:"Armenia",aliases:["AM"]},{name:"Aruba",aliases:["AW"]},{name:"Australia",aliases:["AU"]},{name:"Austria",aliases:["AT"]},{name:"Azerbaijan",aliases:["AZ"]},{name:"Bahamas",aliases:["BS"]},{name:"Bahrain",aliases:["BH"]},{name:"Bangladesh",aliases:["BD"]},{name:"Barbados",aliases:["BB"]},{name:"Belarus",aliases:["BY"]},{name:"Belgium",aliases:["BE"]},{name:"Belize",aliases:["BZ"]},{name:"Benin",aliases:["BJ"]},{name:"Bermuda",aliases:["BM"]},{name:"Bhutan",aliases:["BT"]},{name:"Bolivia, Plurinational State of",aliases:["BO","Bolivia"]},{name:"Bonaire, Sint Eustatius and Saba",aliases:["BQ"]},{name:"Bosnia and Herzegovina",aliases:["BA"]},{name:"Botswana",aliases:["BW"]},{name:"Bouvet Island",aliases:["BV"]},{name:"Brazil",aliases:["BR"]},{name:"British Indian Ocean Territory",aliases:["IO"]},{name:"Brunei Darussalam",aliases:["BN"]},{name:"Bulgaria",aliases:["BG"]},{name:"Burkina Faso",aliases:["BF"]},{name:"Burundi",aliases:["BI"]},{name:"Cambodia",aliases:["KH"]},{name:"Cameroon",aliases:["CM"]},{name:"Canada",aliases:["CA"]},{name:"Cape Verde",aliases:["CV"]},{name:"Cayman Islands",aliases:["KY"]},{name:"Central African Republic",aliases:["CF"]},{name:"Chad",aliases:["TD"]},{name:"Chile",aliases:["CL"]},{name:"China",aliases:["CN"]},{name:"Christmas Island",aliases:["CX"]},{name:"Cocos (Keeling) Islands",aliases:["CC"]},{name:"Colombia",aliases:["CO"]},{name:"Comoros",aliases:["KM"]},{name:"Congo",aliases:["CG"]},{name:"Congo, the Democratic Republic of the",aliases:["CD"]},{name:"Cook Islands",aliases:["CK"]},{name:"Costa Rica",aliases:["CR"]},{name:"Côte d'Ivoire",aliases:["CI"]},{name:"Croatia",aliases:["HR"]},{name:"Cuba",aliases:["CU"]},{name:"Curaçao",aliases:["CW"]},{name:"Cyprus",aliases:["CY"]},{name:"Czech Republic",aliases:["CZ"]},{name:"Denmark",aliases:["DK"]},{name:"Djibouti",aliases:["DJ"]},{name:"Dominica",aliases:["DM"]},{name:"Dominican Republic",aliases:["DO"]},{name:"Ecuador",aliases:["EC"]},{name:"Egypt",aliases:["EG"]},{name:"El Salvador",aliases:["SV"]},{name:"Equatorial Guinea",aliases:["GQ"]},{name:"Eritrea",aliases:["ER"]},{name:"Estonia",aliases:["EE"]},{name:"Ethiopia",aliases:["ET"]},{name:"Falkland Islands (Malvinas)",aliases:["FK"]},{name:"Faroe Islands",aliases:["FO"]},{name:"Fiji",aliases:["FJ"]},{name:"Finland",aliases:["FI"]},{name:"France",aliases:["FR"]},{name:"French Guiana",aliases:["GF"]},{name:"French Polynesia",aliases:["PF"]},{name:"French Southern Territories",aliases:["TF"]},{name:"Gabon",aliases:["GA"]},{name:"Gambia",aliases:["GM"]},{name:"Georgia",aliases:["GE"]},{name:"Germany",aliases:["DE"]},{name:"Ghana",aliases:["GH"]},{name:"Gibraltar",aliases:["GI"]},{name:"Greece",aliases:["GR"]},{name:"Greenland",aliases:["GL"]},{name:"Grenada",aliases:["GD"]},{name:"Guadeloupe",aliases:["GP"]},{name:"Guam",aliases:["GU"]},{name:"Guatemala",aliases:["GT"]},{name:"Guernsey",aliases:["GG"]},{name:"Guinea",aliases:["GN"]},{name:"Guinea-Bissau",aliases:["GW"]},{name:"Guyana",aliases:["GY"]},{name:"Haiti",aliases:["HT"]},{name:"Heard Island and McDonald Islands",aliases:["HM"]},{name:"Holy See (Vatican City State)",aliases:["VA"]},{name:"Honduras",aliases:["HN"]},{name:"Hong Kong",aliases:["HK"]},{name:"Hungary",aliases:["HU"]},{name:"Iceland",aliases:["IS"]},{name:"India",aliases:["IN"]},{name:"Indonesia",aliases:["ID"]},{name:"Iran, Islamic Republic of",aliases:["IR"]},{name:"Iraq",aliases:["IQ"]},{name:"Ireland",aliases:["IE"]},{name:"Isle of Man",aliases:["IM"]},{name:"Israel",aliases:["IL"]},{name:"Italy",aliases:["IT"]},{name:"Jamaica",aliases:["JM"]},{name:"Japan",aliases:["JP"]},{name:"Jersey",aliases:["JE"]},{name:"Jordan",aliases:["JO"]},{name:"Kazakhstan",aliases:["KZ"]},{name:"Kenya",aliases:["KE"]},{name:"Kiribati",aliases:["KI"]},{name:"Korea, Democratic People's Republic of",aliases:["KP"]},{name:"Korea, Republic of",aliases:["KR"]},{name:"Kuwait",aliases:["KW"]},{name:"Kyrgyzstan",aliases:["KG"]},{name:"Lao People's Democratic Republic",aliases:["LA"]},{name:"Latvia",aliases:["LV"]},{name:"Lebanon",aliases:["LB"]},{name:"Lesotho",aliases:["LS"]},{name:"Liberia",aliases:["LR"]},{name:"Libya",aliases:["LY"]},{name:"Liechtenstein",aliases:["LI"]},{name:"Lithuania",aliases:["LT"]},{name:"Luxembourg",aliases:["LU"]},{name:"Macao",aliases:["MO"]},{name:"Macedonia, the former Yugoslav Republic of",aliases:["MK"]},{name:"Madagascar",aliases:["MG"]},{name:"Malawi",aliases:["MW"]},{name:"Malaysia",aliases:["MY"]},{name:"Maldives",aliases:["MV"]},{name:"Mali",aliases:["ML"]},{name:"Malta",aliases:["MT"]},{name:"Marshall Islands",aliases:["MH"]},{name:"Martinique",aliases:["MQ"]},{name:"Mauritania",aliases:["MR"]},{name:"Mauritius",aliases:["MU"]},{name:"Mayotte",aliases:["YT"]},{name:"Mexico",aliases:["MX"]},{name:"Micronesia, Federated States of",aliases:["FM"]},{name:"Moldova, Republic of",aliases:["MD"]},{name:"Monaco",aliases:["MC"]},{name:"Mongolia",aliases:["MN"]},{name:"Montenegro",aliases:["ME"]},{name:"Montserrat",aliases:["MS"]},{name:"Morocco",aliases:["MA"]},{name:"Mozambique",aliases:["MZ"]},{name:"Myanmar",aliases:["MM"]},{name:"Namibia",aliases:["NA"]},{name:"Nauru",aliases:["NR"]},{name:"Nepal",aliases:["NP"]},{name:"Netherlands",aliases:["NL"]},{name:"New Caledonia",aliases:["NC"]},{name:"New Zealand",aliases:["NZ"]},{name:"Nicaragua",aliases:["NI"]},{name:"Niger",aliases:["NE"]},{name:"Nigeria",aliases:["NG"]},{name:"Niue",aliases:["NU"]},{name:"Norfolk Island",aliases:["NF"]},{name:"Northern Mariana Islands",aliases:["MP"]},{name:"Norway",aliases:["NO"]},{name:"Oman",aliases:["OM"]},{name:"Pakistan",aliases:["PK"]},{name:"Palau",aliases:["PW"]},{name:"Palestinian Territory, Occupied",aliases:["PS"]},{name:"Panama",aliases:["PA"]},{name:"Papua New Guinea",aliases:["PG"]},{name:"Paraguay",aliases:["PY"]},{name:"Peru",aliases:["PE"]},{name:"Philippines",aliases:["PH"]},{name:"Pitcairn",aliases:["PN"]},{name:"Poland",aliases:["PL"]},{name:"Portugal",aliases:["PT"]},{name:"Puerto Rico",aliases:["PR"]},{name:"Qatar",aliases:["QA"]},{name:"Réunion",aliases:["RE"]},{name:"Romania",aliases:["RO"]},{name:"Russian Federation",aliases:["RU"]},{name:"Rwanda",aliases:["RW"]},{name:"Saint Barthélemy",aliases:["BL"]},{name:"Saint Helena, Ascension and Tristan da Cunha",aliases:["SH"]},{name:"Saint Kitts and Nevis",aliases:["KN"]},{name:"Saint Lucia",aliases:["LC"]},{name:"Saint Martin (French part)",aliases:["MF"]},{name:"Saint Pierre and Miquelon",aliases:["PM"]},{name:"Saint Vincent and the Grenadines",aliases:["VC"]},{name:"Samoa",aliases:["WS"]},{name:"San Marino",aliases:["SM"]},{name:"Sao Tome and Principe",aliases:["ST"]},{name:"Saudi Arabia",aliases:["SA"]},{name:"Senegal",aliases:["SN"]},{name:"Serbia",aliases:["RS"]},{name:"Seychelles",aliases:["SC"]},{name:"Sierra Leone",aliases:["SL"]},{name:"Singapore",aliases:["SG"]},{name:"Sint Maarten (Dutch part)",aliases:["SX"]},{name:"Slovakia",aliases:["SK"]},{name:"Slovenia",aliases:["SI"]},{name:"Solomon Islands",aliases:["SB"]},{name:"Somalia",aliases:["SO"]},{name:"South Africa",aliases:["ZA"]},{name:"South Georgia and the South Sandwich Islands",aliases:["GS"]},{name:"South Sudan",aliases:["SS"]},{name:"Spain",aliases:["ES"]},{name:"Sri Lanka",aliases:["LK"]},{name:"Sudan",aliases:["SD"]},{name:"Suriname",aliases:["SR"]},{name:"Svalbard and Jan Mayen",aliases:["SJ"]},{name:"Swaziland",aliases:["SZ"]},{name:"Sweden",aliases:["SE"]},{name:"Switzerland",aliases:["CH"]},{name:"Syrian Arab Republic",aliases:["SY"]},{name:"Taiwan, Province of China",aliases:["TW"]},{name:"Tajikistan",aliases:["TJ"]},{name:"Tanzania, United Republic of",aliases:["TZ"]},{name:"Thailand",aliases:["TH"]},{name:"Timor-Leste",aliases:["TL"]},{name:"Togo",aliases:["TG"]},{name:"Tokelau",aliases:["TK"]},{name:"Tonga",aliases:["TO"]},{name:"Trinidad and Tobago",aliases:["TT"]},{name:"Tunisia",aliases:["TN"]},{name:"Turkey",aliases:["TR"]},{name:"Turkmenistan",aliases:["TM"]},{name:"Turks and Caicos Islands",aliases:["TC"]},{name:"Tuvalu",aliases:["TV"]},{name:"Uganda",aliases:["UG"]},{name:"Ukraine",aliases:["UA"]},{name:"United Arab Emirates",aliases:["AE"]},{name:"United Kingdom",aliases:["GB"]},{name:"United States",aliases:["US","USA","United States of America"]},{name:"United States Minor Outlying Islands",aliases:["UM"]},{name:"Uruguay",aliases:["UY"]},{name:"Uzbekistan",aliases:["UZ"]},{name:"Vanuatu",aliases:["VU"]},{name:"Venezuela, Bolivarian Republic of",aliases:["VE"]},{name:"Viet Nam",aliases:["VN"]},{name:"Virgin Islands, British",aliases:["VG"]},{name:"Virgin Islands, U.S.",aliases:["VI"]},{name:"Wallis and Futuna",aliases:["WF"]},{name:"Western Sahara",aliases:["EH"]},{name:"Yemen",aliases:["YE"]},{name:"Zambia",aliases:["ZM"]},{name:"Zimbabwe",aliases:["ZW"]}];i=a.flatten(a.map(r,function(a){return[a.name,a.aliases]}));t={};a.each(r,function(e){var s;s=e.name.toLowerCase();t[s]=s;return a.each(e.aliases,function(a){return t[a.toLowerCase()]=s})});l=s("("+a.keys(r).join("|")+")");var o,m=[].indexOf||function(a){for(var e=0,s=this.length;e<s;e++){if(e in this&&this[e]===a)return e}return-1};o=function(){function e(e,n,i){this.name=e;this.expression=n;if(i==null){i={}}this.options=a.defaults(i,{rex_flags:"xi",valid_tests:[],invalid_tests:[]});this.rex=s("^"+n+"$",this.options.rex_flags)}e.prototype.match=function(e){var n,i,l;l=s.exec(e,this.rex);if(l===null){return null}n=["index","input"];i={};a.each(a.keys(l),function(a){if(m.call(n,a)<0&&isNaN(a)){return i[a]=l[a]}});return i};e.prototype.isLineMatcherClass=true;return e}();var u,m=[].indexOf||function(a){for(var e=0,s=this.length;e<s;e++){if(e in this&&this[e]===a)return e}return-1};u=function(){function e(){}e._registered_strategies={};e.prototype.register=function(){var a;a=this.name.toLowerCase();if(!a){throw new Error("Strategies require a `name`")}if(m.call(e._registered_strategies,a)>=0){throw new Error("Strategy "+a+" registered twice")}return e._registered_strategies[a]=this};e.all_strategies=function(){return this._registered_strategies};e.prototype.run_rex_line_strategy=function(e,s){var n;n={};if(e.length!==s.length){throw new Error("Matcher expects "+e.length+" lines,"+(" but the address has "+s.length+" lines."))}a.each(e,function(e,i){var l;l=e.match(s[i]);if(l===null){throw new Error("Line "+i+" is not a valid "+e.name)}return a.extend(n,l)});return n};e.prototype.run_line_strategies=function(e,s){var n,i=this;n=null;a.any(e,function(a,e){try{n=i.run_rex_line_strategy(a,s)}catch(l){return false}return n!==null});return n};e.prototype.debug_line_strategies=function(e,s){var n,i=this;n=a.map(s,function(a,e){return""+e+": "+a}).join("\n");console.log("\n** Debugging:\n"+n);return a.each(e,function(a,e){var n;console.log("Skipping strategy "+e+"; mismatched line count");if(a.length!==s.length){return}try{return n=i.run_rex_line_strategy(a,s)}catch(l){return console.log("Rex failed: "+l)}})};e.prototype.parse_address=function(e,s){var n,i;if(e.length<2){throw new Error("Addresses must be at least two lines.")}n=this.line_strategies()||[];i=this.run_line_strategies(n,e)||{};if(a.isEmpty(i)){this.debug_line_strategies(n,e)}return a.defaults(i,this.expected_fields())};return e}();u.do_parse_address=function(a,e,s){var n,i;if(i=!a,m.call(u._registered_strategies,i)>=0){throw new Error("No strategy to parse an address for "+a)}n=u._registered_strategies[a];return n.parse_address(e,s)};var d,c={}.hasOwnProperty,p=function(a,e){for(var s in e){if(c.call(e,s))a[s]=e[s]}function n(){this.constructor=a}n.prototype=e.prototype;a.prototype=new n;a.__super__=e.prototype;return a};d=function(a){var e,s,n,i,l,t,r;p(m,a);function m(){return m.__super__.constructor.apply(this,arguments)}m.prototype.name="canada";r=["AB","Alberta","BC","British\\s+Columbia","Manitoba","MB","New Brunswick","NB","Newfoundland\\s+and\\s+Labrador","Newfoundland","NF","NL","Newfoundland\\s+&\\s+Labrador","Northwest Territories","NT","Nova Scotia","NS","Nunavut","NU","ON","Ontario","Prince\\s+Edward\\s+Island","PE","PEI","Quebec","QC","Saskatchewan","SK","Yukon","YT"];e=new o("Addressee","(?<addressee> [\\p{L}\\s-\\.]+)",{valid_tests:["Mary Swånson"],invalid_tests:["100 Sampsonite Drive"]});l=new o("Street","(?:(?<suite> [^-]+) \\s* - \\s*)?    (?<street_number> \\d+)? \\s+    (?<street_name> .*?)",{valid_tests:["100 huntley street","Ünit 215 - 100 Huntley Street"],invalid_tests:["Wallaby Lane"]});t=new o("Second street line","(.+)",{valid_tests:["Anything"],invalid_tests:[""]});s=new o("Municipality and Province","(?<municipality> [\\p{L}\\s\\.]+?) \\s* ,? \\s*     (?<province> "+r.join("|")+")",{valid_tests:["St. Pétersberg, ON","Hudsonville, QC"],invalid_tests:["St. Peteresberg, Peterborough, 10005"]});i=new o("Postal code","(?<postal> s*\\w\\d\\w\\s*\\d\\w\\d)",{valid_tests:["H0H0H0","H0H  0H0"],invalid_tests:["HoH 0H0","HoH 0ü0"]});n=new o("Municipality, province and postal code",""+s.expression+" (?: \\s* ,? \\s* "+i.expression+")?",{valid_tests:["One, QC, M5R 1V2","Two Tee, ON"],invalid_tests:["Two, Two, Two"]});m.prototype.expected_fields=function(){return{suite:"",addressee:"",street_number:"",street_name_2:"",municipality:"",province:"",postal:"",country:"Canada"}};m.prototype.line_strategies=function(){var a;a=[];a.push([e,l,t,s,i]);a.push([e,l,s,i]);a.push([l,t,s,i]);a.push([l,s,i]);a.push([e,l,t,n]);a.push([e,l,n]);a.push([l,t,n]);a.push([l,n]);return a};return m}(u);(new d).register();var h,m=[].indexOf||function(a){for(var e=0,s=this.length;e<s;e++){if(e in this&&this[e]===a)return e}return-1};h=function(){function e(a){this._defaultCountry=a}e.prototype.AddressStrategy=u;e.prototype.Version=n;e.prototype.parse=function(e,s){var n,l,r,o,d;if(!a.isString(e)){throw new Error("Address must be a string, got "+typeof e+".")}o=a.filter(a.map(e.split("\n"),function(a){return a.trim()}),a.identity);if(o.length<2){throw new Error("Addresses must be at least two lines long")}r=o[o.length-1];if(m.call(i,r)>=0){l=o.pop()}else if(s){l=s}else{l=this.defaultCountry}if(!l){throw new Error("Address parsing cannot determine what country to use")}n=t[l.toLowerCase()];d=u.do_parse_address(n,o,e);return d};return e}();return new h})