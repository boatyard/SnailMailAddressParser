if(typeof require!=="function"){if(typeof XRegExp!=="function"){console.log("No XRegExp object found - is it installed?.")}if(typeof _!=="function"){console.log("Underscore or lodash were not found. Is one installed?")}var define=function(a,e){window.snailmailaddressparser=e(_,{XRegExp:XRegExp})}}else{if(typeof define!=="function"){var define=require("amdefine")(module)}}define(["underscore","xregexp"],function(a,e){var s=e.XRegExp,n;s.addUnicodePackage();n="0.1.16";var i,t;if(typeof module!=="undefined"&&module.exports){i=function(a,e,s){if(e==null){e=false}if(s==null){s=2}return require("util").inspect(a,e,s,true)};t=function(a){return require("util").debug(a)}}else{i=function(a){return console.log(a)};t=function(a){return console.log(a)}}var l,r,o,m;m=[{name:"Afghanistan",aliases:["AF"]},{name:"Åland Islands",aliases:["AX","Aland Islands"]},{name:"Albania",aliases:["AL"]},{name:"Algeria",aliases:["DZ"]},{name:"American Samoa",aliases:["AS"]},{name:"Andorra",aliases:["AD"]},{name:"Angola",aliases:["AO"]},{name:"Anguilla",aliases:["AI"]},{name:"Antarctica",aliases:["AQ"]},{name:"Antigua and Barbuda",aliases:["AG"]},{name:"Argentina",aliases:["AR"]},{name:"Armenia",aliases:["AM"]},{name:"Aruba",aliases:["AW"]},{name:"Australia",aliases:["AU"]},{name:"Austria",aliases:["AT"]},{name:"Azerbaijan",aliases:["AZ"]},{name:"Bahamas",aliases:["BS"]},{name:"Bahrain",aliases:["BH"]},{name:"Bangladesh",aliases:["BD"]},{name:"Barbados",aliases:["BB"]},{name:"Belarus",aliases:["BY"]},{name:"Belgium",aliases:["BE"]},{name:"Belize",aliases:["BZ"]},{name:"Benin",aliases:["BJ"]},{name:"Bermuda",aliases:["BM"]},{name:"Bhutan",aliases:["BT"]},{name:"Bolivia, Plurinational State of",aliases:["BO","Bolivia"]},{name:"Bonaire, Sint Eustatius and Saba",aliases:["BQ"]},{name:"Bosnia and Herzegovina",aliases:["BA"]},{name:"Botswana",aliases:["BW"]},{name:"Bouvet Island",aliases:["BV"]},{name:"Brazil",aliases:["BR"]},{name:"British Indian Ocean Territory",aliases:["IO"]},{name:"Brunei Darussalam",aliases:["BN"]},{name:"Bulgaria",aliases:["BG"]},{name:"Burkina Faso",aliases:["BF"]},{name:"Burundi",aliases:["BI"]},{name:"Cambodia",aliases:["KH"]},{name:"Cameroon",aliases:["CM"]},{name:"Canada",aliases:["CA"]},{name:"Cape Verde",aliases:["CV"]},{name:"Cayman Islands",aliases:["KY"]},{name:"Central African Republic",aliases:["CF"]},{name:"Chad",aliases:["TD"]},{name:"Chile",aliases:["CL"]},{name:"China",aliases:["CN"]},{name:"Christmas Island",aliases:["CX"]},{name:"Cocos (Keeling) Islands",aliases:["CC"]},{name:"Colombia",aliases:["CO"]},{name:"Comoros",aliases:["KM"]},{name:"Congo",aliases:["CG"]},{name:"Congo, the Democratic Republic of the",aliases:["CD"]},{name:"Cook Islands",aliases:["CK"]},{name:"Costa Rica",aliases:["CR"]},{name:"Côte d'Ivoire",aliases:["CI"]},{name:"Croatia",aliases:["HR"]},{name:"Cuba",aliases:["CU"]},{name:"Curaçao",aliases:["CW"]},{name:"Cyprus",aliases:["CY"]},{name:"Czech Republic",aliases:["CZ"]},{name:"Denmark",aliases:["DK"]},{name:"Djibouti",aliases:["DJ"]},{name:"Dominica",aliases:["DM"]},{name:"Dominican Republic",aliases:["DO"]},{name:"Ecuador",aliases:["EC"]},{name:"Egypt",aliases:["EG"]},{name:"El Salvador",aliases:["SV"]},{name:"Equatorial Guinea",aliases:["GQ"]},{name:"Eritrea",aliases:["ER"]},{name:"Estonia",aliases:["EE"]},{name:"Ethiopia",aliases:["ET"]},{name:"Falkland Islands (Malvinas)",aliases:["FK"]},{name:"Faroe Islands",aliases:["FO"]},{name:"Fiji",aliases:["FJ"]},{name:"Finland",aliases:["FI"]},{name:"France",aliases:["FR"]},{name:"French Guiana",aliases:["GF"]},{name:"French Polynesia",aliases:["PF"]},{name:"French Southern Territories",aliases:["TF"]},{name:"Gabon",aliases:["GA"]},{name:"Gambia",aliases:["GM"]},{name:"Georgia",aliases:["GE"]},{name:"Germany",aliases:["DE"]},{name:"Ghana",aliases:["GH"]},{name:"Gibraltar",aliases:["GI"]},{name:"Greece",aliases:["GR"]},{name:"Greenland",aliases:["GL"]},{name:"Grenada",aliases:["GD"]},{name:"Guadeloupe",aliases:["GP"]},{name:"Guam",aliases:["GU"]},{name:"Guatemala",aliases:["GT"]},{name:"Guernsey",aliases:["GG"]},{name:"Guinea",aliases:["GN"]},{name:"Guinea-Bissau",aliases:["GW"]},{name:"Guyana",aliases:["GY"]},{name:"Haiti",aliases:["HT"]},{name:"Heard Island and McDonald Islands",aliases:["HM"]},{name:"Holy See (Vatican City State)",aliases:["VA"]},{name:"Honduras",aliases:["HN"]},{name:"Hong Kong",aliases:["HK"]},{name:"Hungary",aliases:["HU"]},{name:"Iceland",aliases:["IS"]},{name:"India",aliases:["IN"]},{name:"Indonesia",aliases:["ID"]},{name:"Iran, Islamic Republic of",aliases:["IR"]},{name:"Iraq",aliases:["IQ"]},{name:"Ireland",aliases:["IE"]},{name:"Isle of Man",aliases:["IM"]},{name:"Israel",aliases:["IL"]},{name:"Italy",aliases:["IT"]},{name:"Jamaica",aliases:["JM"]},{name:"Japan",aliases:["JP"]},{name:"Jersey",aliases:["JE"]},{name:"Jordan",aliases:["JO"]},{name:"Kazakhstan",aliases:["KZ"]},{name:"Kenya",aliases:["KE"]},{name:"Kiribati",aliases:["KI"]},{name:"Korea, Democratic People's Republic of",aliases:["KP"]},{name:"Korea, Republic of",aliases:["KR"]},{name:"Kuwait",aliases:["KW"]},{name:"Kyrgyzstan",aliases:["KG"]},{name:"Lao People's Democratic Republic",aliases:["LA"]},{name:"Latvia",aliases:["LV"]},{name:"Lebanon",aliases:["LB"]},{name:"Lesotho",aliases:["LS"]},{name:"Liberia",aliases:["LR"]},{name:"Libya",aliases:["LY"]},{name:"Liechtenstein",aliases:["LI"]},{name:"Lithuania",aliases:["LT"]},{name:"Luxembourg",aliases:["LU"]},{name:"Macao",aliases:["MO"]},{name:"Macedonia, the former Yugoslav Republic of",aliases:["MK"]},{name:"Madagascar",aliases:["MG"]},{name:"Malawi",aliases:["MW"]},{name:"Malaysia",aliases:["MY"]},{name:"Maldives",aliases:["MV"]},{name:"Mali",aliases:["ML"]},{name:"Malta",aliases:["MT"]},{name:"Marshall Islands",aliases:["MH"]},{name:"Martinique",aliases:["MQ"]},{name:"Mauritania",aliases:["MR"]},{name:"Mauritius",aliases:["MU"]},{name:"Mayotte",aliases:["YT"]},{name:"Mexico",aliases:["MX"]},{name:"Micronesia, Federated States of",aliases:["FM"]},{name:"Moldova, Republic of",aliases:["MD"]},{name:"Monaco",aliases:["MC"]},{name:"Mongolia",aliases:["MN"]},{name:"Montenegro",aliases:["ME"]},{name:"Montserrat",aliases:["MS"]},{name:"Morocco",aliases:["MA"]},{name:"Mozambique",aliases:["MZ"]},{name:"Myanmar",aliases:["MM"]},{name:"Namibia",aliases:["NA"]},{name:"Nauru",aliases:["NR"]},{name:"Nepal",aliases:["NP"]},{name:"Netherlands",aliases:["NL"]},{name:"New Caledonia",aliases:["NC"]},{name:"New Zealand",aliases:["NZ"]},{name:"Nicaragua",aliases:["NI"]},{name:"Niger",aliases:["NE"]},{name:"Nigeria",aliases:["NG"]},{name:"Niue",aliases:["NU"]},{name:"Norfolk Island",aliases:["NF"]},{name:"Northern Mariana Islands",aliases:["MP"]},{name:"Norway",aliases:["NO"]},{name:"Oman",aliases:["OM"]},{name:"Pakistan",aliases:["PK"]},{name:"Palau",aliases:["PW"]},{name:"Palestinian Territory, Occupied",aliases:["PS"]},{name:"Panama",aliases:["PA"]},{name:"Papua New Guinea",aliases:["PG"]},{name:"Paraguay",aliases:["PY"]},{name:"Peru",aliases:["PE"]},{name:"Philippines",aliases:["PH"]},{name:"Pitcairn",aliases:["PN"]},{name:"Poland",aliases:["PL"]},{name:"Portugal",aliases:["PT"]},{name:"Puerto Rico",aliases:["PR"]},{name:"Qatar",aliases:["QA"]},{name:"Réunion",aliases:["RE"]},{name:"Romania",aliases:["RO"]},{name:"Russian Federation",aliases:["RU"]},{name:"Rwanda",aliases:["RW"]},{name:"Saint Barthélemy",aliases:["BL"]},{name:"Saint Helena, Ascension and Tristan da Cunha",aliases:["SH"]},{name:"Saint Kitts and Nevis",aliases:["KN"]},{name:"Saint Lucia",aliases:["LC"]},{name:"Saint Martin (French part)",aliases:["MF"]},{name:"Saint Pierre and Miquelon",aliases:["PM"]},{name:"Saint Vincent and the Grenadines",aliases:["VC"]},{name:"Samoa",aliases:["WS"]},{name:"San Marino",aliases:["SM"]},{name:"Sao Tome and Principe",aliases:["ST"]},{name:"Saudi Arabia",aliases:["SA"]},{name:"Senegal",aliases:["SN"]},{name:"Serbia",aliases:["RS"]},{name:"Seychelles",aliases:["SC"]},{name:"Sierra Leone",aliases:["SL"]},{name:"Singapore",aliases:["SG"]},{name:"Sint Maarten (Dutch part)",aliases:["SX"]},{name:"Slovakia",aliases:["SK"]},{name:"Slovenia",aliases:["SI"]},{name:"Solomon Islands",aliases:["SB"]},{name:"Somalia",aliases:["SO"]},{name:"South Africa",aliases:["ZA"]},{name:"South Georgia and the South Sandwich Islands",aliases:["GS"]},{name:"South Sudan",aliases:["SS"]},{name:"Spain",aliases:["ES"]},{name:"Sri Lanka",aliases:["LK"]},{name:"Sudan",aliases:["SD"]},{name:"Suriname",aliases:["SR"]},{name:"Svalbard and Jan Mayen",aliases:["SJ"]},{name:"Swaziland",aliases:["SZ"]},{name:"Sweden",aliases:["SE"]},{name:"Switzerland",aliases:["CH"]},{name:"Syrian Arab Republic",aliases:["SY"]},{name:"Taiwan, Province of China",aliases:["TW"]},{name:"Tajikistan",aliases:["TJ"]},{name:"Tanzania, United Republic of",aliases:["TZ"]},{name:"Thailand",aliases:["TH"]},{name:"Timor-Leste",aliases:["TL"]},{name:"Togo",aliases:["TG"]},{name:"Tokelau",aliases:["TK"]},{name:"Tonga",aliases:["TO"]},{name:"Trinidad and Tobago",aliases:["TT"]},{name:"Tunisia",aliases:["TN"]},{name:"Turkey",aliases:["TR"]},{name:"Turkmenistan",aliases:["TM"]},{name:"Turks and Caicos Islands",aliases:["TC"]},{name:"Tuvalu",aliases:["TV"]},{name:"Uganda",aliases:["UG"]},{name:"Ukraine",aliases:["UA"]},{name:"United Arab Emirates",aliases:["AE"]},{name:"United Kingdom",aliases:["GB"]},{name:"United States",aliases:["US","USA","United States of America"]},{name:"United States Minor Outlying Islands",aliases:["UM"]},{name:"Uruguay",aliases:["UY"]},{name:"Uzbekistan",aliases:["UZ"]},{name:"Vanuatu",aliases:["VU"]},{name:"Venezuela, Bolivarian Republic of",aliases:["VE"]},{name:"Viet Nam",aliases:["VN"]},{name:"Virgin Islands, British",aliases:["VG"]},{name:"Virgin Islands, U.S.",aliases:["VI"]},{name:"Wallis and Futuna",aliases:["WF"]},{name:"Western Sahara",aliases:["EH"]},{name:"Yemen",aliases:["YE"]},{name:"Zambia",aliases:["ZM"]},{name:"Zimbabwe",aliases:["ZW"]}];l=a.flatten(a.map(m,function(a){return[a.name,a.aliases]}));o={};a.each(m,function(e){var s;s=e.name.toLowerCase();o[s]=s;return a.each(e.aliases,function(a){return o[a.toLowerCase()]=s})});r=s("("+a.keys(m).join("|")+")");var u,d=[].slice;u=function(){function e(){this._list=[]}e.prototype.add=function(){var e,s;e=1<=arguments.length?d.call(arguments,0):[];s=[a.toArray(e)];a.each(e,function(e,n){var i;if(!e.is_optional()){return}i=[];a.each(s,function(s){var n;n=a.clone(s);n.splice(n.indexOf(e),1);return i.push(n)});return s=s.concat(i)});return this._list=this._list.concat(s)};e.prototype.all=function(){return this._list};return e}();var c,p=[].indexOf||function(a){for(var e=0,s=this.length;e<s;e++){if(e in this&&this[e]===a)return e}return-1};c=function(){function e(e,n,i){this.name=e;this.expression=n;if(i==null){i={}}this.options=a.defaults(i,{invalid_tests:[],is_optional:false,rex_flags:"xi",valid_tests:[],_or:null});this.rex=s("^"+n+"$",this.options.rex_flags)}e.prototype.optional=function(){var e;e=a.clone(this);e.options.is_optional=true;return e};e.prototype.mandatory=function(){var e;e=a.clone(this);e.options.is_optional=false;return e};e.prototype.is_optional=function(){return this.options.is_optional};e.prototype.or=function(e){if(a.isObject(this.options._or)){if(this.options._or.name===e.name){return this}this.options._or.or(e)}else{this.options._or=e}return this};e.prototype.match=function(e,n){var i,t,l,r;if(n==null){n=true}l=s.exec(e,this.rex);if(l===null){if(n){return((r=this.options._or)!=null?typeof r.match==="function"?r.match(e):void 0:void 0)||null}else{return n}}i=["index","input"];t={};a.each(a.keys(l),function(a){if(p.call(i,a)<0&&isNaN(a)){return t[a]=l[a]}});return t};e.prototype.isLineMatcherClass=true;return e}();var f,p=[].indexOf||function(a){for(var e=0,s=this.length;e<s;e++){if(e in this&&this[e]===a)return e}return-1};f=function(){function e(){}e._registered_strategies={};e.prototype.register=function(){var a;a=this.name.toLowerCase();if(!a){throw new Error("Strategies require a `name`")}if(p.call(e._registered_strategies,a)>=0){throw new Error("Strategy "+a+" registered twice")}return e._registered_strategies[a]=this};e.all_strategies=function(){return this._registered_strategies};e.prototype.run_rex_line_strategy=function(e,s){var n;n={};if(e.length!==s.length){throw new Error("Matcher expects "+e.length+" lines,"+(" but the address has "+s.length+" lines."))}a.each(e,function(e,i){var t;t=e.match(s[i]);if(t===null){throw new Error("Line "+i+" is not a valid "+e.name)}return a.extend(n,t)});return n};e.prototype.run_line_strategies=function(e,s){var n,i=this;n=null;a.any(e,function(a,e){try{n=i.run_rex_line_strategy(a,s)}catch(t){return false}return n!==null});return n};e.prototype.debug_line_strategies=function(e,s){var n,i=this;n=a.map(s,function(a,e){return""+e+": "+a}).join("\n");console.log("\n** Debugging:\n"+n);return a.each(e,function(a,e){var n;console.log("Skipping strategy "+e+"; mismatched line count");if(a.length!==s.length){return}try{return n=i.run_rex_line_strategy(a,s)}catch(t){return console.log("Rex failed: "+t)}})};e.prototype.parse_address=function(e,s){var n,i;if(e.length<2){throw new Error("Addresses must be at least two lines.")}n=this.line_strategies()||[];i=this.run_line_strategies(n,e)||{};if(a.isEmpty(i)){this.debug_line_strategies(n,e)}return a.defaults(i,this.expected_fields())};return e}();f.do_parse_address=function(e,s){var n,i,t,l,r,m,u,d,c,h;s=a.defaults(s,{defaultCountry:"",debug:false});u=[];r=[];l=a.filter(a.map(e.split("\n"),function(a){return a.trim()}),a.identity);if(l.length<2){throw new Error("Addresses must be at least two lines long")}t=l[l.length-1];if(h=t.toLowerCase(),p.call(a.keys(o),h)>=0){n=l.pop().toLowerCase()}else if(s.defaultCountry){n=s.defaultCountry}if(n){i=o[n.toLowerCase()];if(p.call(a.keys(f._registered_strategies),i)>=0){u=[f._registered_strategies[i]]}}if(a.isEmpty(u)){u=a.values(f._registered_strategies)}for(d=0,c=u.length;d<c;d++){m=u[d];r.push(m.parse_address(l,e,s.debug))}return{matches:a.flatten(r)}};var h,g={}.hasOwnProperty,y=function(a,e){for(var s in e){if(g.call(e,s))a[s]=e[s]}function n(){this.constructor=a}n.prototype=e.prototype;a.prototype=new n;a.__super__=e.prototype;return a};h=function(a){var e,s,n,i,t,l,r,o,m,d,p;y(f,a);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.name="canada";m=["AB","Alberta","BC","British\\s+Columbia","Manitoba","MB","New Brunswick","NB","Newfoundland\\s+and\\s+Labrador","Newfoundland","NF","NL","Newfoundland\\s+&\\s+Labrador","Northwest Territories","NT","Nova Scotia","NS","Nunavut","NU","ON","Ontario","Prince\\s+Edward\\s+Island","PE","PEI","Quebec","QC","Saskatchewan","SK","Yukon","YT"];e=new c("Addressee","(?<addressee> [\\p{L}\\s-\\.]+)",{valid_tests:{"Mary Swånson":{addressee:"Mary Swånson"}},invalid_tests:["100 Sampsonite Drive"]});p="(?: apt\\.? | apartment | unit | suite | floor | fl\\.?  ) \\s* \\#? \\s+";d="(?<street_number> \\d+)? \\s+\n(?<street_name> (?: \\p{L}|[\\.\\s\\-'])+? )";i=new c("Plain street",d,{valid_tests:{"42 Wallaby Lane":{street_number:"42",street_name:"Wallaby Lane"},"100 Hûntley Street":{street_number:"100",street_name:"Hûntley Street"}},invalid_tests:["Wallaby Lane","Suite 100, 42 Wallaby Lane","42 Wallaby Lane, fl. 2-00"]});o=new c("Unit - Street","(?<suite> [^-]+?) \\s* [\\-,] \\s* "+d,{valid_tests:{"Suite 1100a - 42 Wallaby Ave.":{suite:"Suite 1100a",street_number:"42",street_name:"Wallaby Ave."}},invalid_tests:["100 Wish Line, Unit #212","Any street with no unit"]});r=new c("Street - Unit",""+d+" \\s* [,\\-]? \\s* (?<suite> "+p+" \\s* [\\d\\w]+)",{valid_tests:{"42 Wallaby Ave., Suite 1100A":{suite:"Suite 1100A",street_number:"42",street_name:"Wallaby Ave."},"1 Rainy Road unit 115":{suite:"unit 115",street_number:"1",street_name:"Rainy Road"}},invalid_tests:["100 100 100","Any street with no unit"]});l=new c("Second street line","(?<street_name_2> .+)",{valid_tests:{Anything:{street_name_2:"Anything"}},invalid_tests:[""]});s=new c("Municipality and Province","(?<municipality> (?:\\p{L}|[\\-'\\s\\.])+?) \\s* ,? \\s*     (?<province> "+m.join("|")+")",{valid_tests:{"Bras-d'Or, NS":{municipality:"Bras-d'Or",province:"NS"},"St. Pétersberg, ON":{municipality:"St. Pétersberg",province:"ON"},"Hudsonville, QC":{municipality:"Hudsonville",province:"QC"}},invalid_tests:["St. Peteresberg, Peterborough, 10005"]});t=new c("Postal code","(?<postal> s*\\w\\d\\w\\s*\\d\\w\\d)",{valid_tests:{H0H0H0:{postal:"H0H0H0"},"H0H  0H0":{postal:"H0H  0H0"}},invalid_tests:["HoH 0H0","HoH 0ü0"]});n=new c("Municipality, province and postal code",""+s.expression+" (?: \\s* ,? \\s* "+t.expression+")?",{valid_tests:{"One, QC, M5R 1V2":{municipality:"One",province:"QC",postal:"M5R 1V2"},"TreeTree, MB":{municipality:"TreeTree",province:"MB",postal:void 0}},invalid_tests:["Two, Two, Two"]});f.prototype.expected_fields=function(){return{suite:"",addressee:"",street_number:"",street_name_2:"",municipality:"",province:"",postal:"",country:"Canada"}};f.prototype.line_strategies=function(){var a;a=new u;a.add(e.optional(),i.or(o).or(r),l.optional(),s,t);a.add(e.optional(),i.or(o).or(r),l.optional(),n);return a.all()};return f}(f);(new h).register();var S;S=function(){e.prototype.AddressStrategy=f;e.prototype.LineMatcher=c;e.prototype.LineMatcherStrategy=u;e.prototype.Version=n;function e(){}e.prototype.parse=function(e,s){if(s==null){s={}}if(!a.isString(e)){throw new Error("Address must be a string, got "+typeof e+".")}return f.do_parse_address(e,s)};return e}();return new S})